<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>public</access>
        <active>true</active>
        <api_name>x_1166825_erp_assi.test</api_name>
        <caller_access/>
        <client_callable>true</client_callable>
        <description>Used for creating ERP product record.</description>
        <name>test</name>
        <script><![CDATA[var test = Class.create();
test.prototype = {
    initialize: function() {
    },

    importProductData: function(current) {
        var saGR = new GlideRecordSecure('sys_attachment');
        saGR.addQuery('table_sys_id', current.sys_id);
        saGR.addQuery('table_name', 'ZZ_YYx_1166825_erp_assi_erp_case');
        saGR.query();

        if (!saGR.next()) {
            gs.addErrorMessage("Please add the attachment");
            return;
        } else {
            var sysAttachmentID = saGR.getUniqueValue();
            if (saGR.getRowCount() > 1) {
                gs.addErrorMessage("Please attach all records in one file");
                return;
            }

            var passedFormatCheck = false;
            if (saGR.file_name.endsWith('.xlsx') || saGR.file_name.endsWith('.xls')) {
                passedFormatCheck = true;
            }

            if (!passedFormatCheck) {
                gs.addErrorMessage("Please attach an Excel file only");
                return;
            }

            gs.addInfoMessage("The file looks good...");

            // Create a new data source
            var dataSource = new GlideRecordSecure('sys_data_source');
            dataSource.initialize();
            dataSource.name = 'ERP product data';
            dataSource.import_set_table_name = 'x_1166825_erp_assi_erp_assist';
            dataSource.file_retrieval_method = 'Attachment';
            dataSource.type = 'File';
            dataSource.format = 'Excel';
            dataSource.header_row = 1;
            dataSource.sheet_number = 1;
            var dataSourceId = dataSource.insert();

            // Update attachment table name to 'sys_data_source'
            var attachment = new GlideRecordSecure('sys_attachment');
            if (attachment.get(sysAttachmentID)) {
                attachment.table_name = 'sys_data_source';
                attachment.table_sys_id = dataSourceId;  // Use the created dataSource ID
                attachment.update();
            }

            // Load the import set
            var loader = new GlideImportSetLoader();
            var importSetRec = loader.getImportSetGr(dataSourceId);
            importSetRec.state = 'loaded';
            importSetRec.update();

            // Transform the import set
            var transformWorker = new GlideImportSetTransformerWorker(importSetRec.sys_id, '851e6e9397cf4e90e3e737d3f153af13'); // Use your transform map sys_id
            transformWorker.setBackground(true);
            transformWorker.start();

            gs.addInfoMessage('The ERP product data is imported successfully');
        }
    },

    type: 'test'
};
]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-07-09 18:08:41</sys_created_on>
        <sys_id>3983f12d979b0ad0e3e737d3f153af5c</sys_id>
        <sys_mod_count>2</sys_mod_count>
        <sys_name>test</sys_name>
        <sys_package display_value="ERP ASSIST" source="x_1166825_erp_assi">cf7d84d797324a50e3e737d3f153af4b</sys_package>
        <sys_policy>read</sys_policy>
        <sys_scope display_value="ERP ASSIST">cf7d84d797324a50e3e737d3f153af4b</sys_scope>
        <sys_update_name>sys_script_include_3983f12d979b0ad0e3e737d3f153af5c</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-07-09 18:12:44</sys_updated_on>
    </sys_script_include>
</record_update>
